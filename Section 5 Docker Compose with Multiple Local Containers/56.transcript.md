### **Synopsis**

This section explains Docker Compose **restart policies**, showing how to automatically restart containers when they crash or exit. It covers the different restart policy options and demonstrates their behavior using a forced crash in the Node.js container.

---

### **Details**

1. **Exit Status Codes**

   * `process.exit(0)` → container exited intentionally, no error.
   * `process.exit(non-zero)` → indicates a failure.
   * Docker restart behavior depends on this exit code.

2. **Adding Restart Policies**

   * In `docker-compose.yml`, you can specify a restart policy for each service:

     ```yaml
     node-app:
       build: .
       ports:
         - "4001:8081"
       restart: always
     ```
   * This ensures the Node app restarts automatically when it stops.

3. **Restart Policy Types**

   * **no**: (default) Do not restart the container.
   * **always**: Always restart the container if it stops, regardless of exit code.
   * **on-failure**: Restart only if the container exits with a non-zero exit code.
   * **unless-stopped**: Restart always unless explicitly stopped via `docker stop`.

4. **Behavior Examples**

   * `always`: container restarts even if `process.exit(0)` is called.
   * `on-failure`: container restarts only if exited with a non-zero code. Exiting with zero will not restart.
   * `unless-stopped`: behaves like `always` but respects manual stops.

5. **Use Cases**

   * **always** → web servers, critical services that must stay up.
   * **on-failure** → worker or batch processes that complete and exit normally.

6. **YAML Quirk**

   * The `no` policy must be quoted (`'no'`) to avoid being interpreted as a Boolean `false`.

7. **Testing**

   * Change `process.exit` codes to see behavior differences.
   * Use `docker-compose up --build` to rebuild the image after code changes.

This setup ensures critical containers remain running and improves reliability of Dockerized services.
