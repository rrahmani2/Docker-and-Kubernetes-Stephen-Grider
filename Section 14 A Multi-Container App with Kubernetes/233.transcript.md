### Creating and Managing PostgreSQL Passwords with Kubernetes Secrets – Technical Notes

#### 1. Objective

Securely store and manage the PostgreSQL database password without writing it in plain text inside Kubernetes configuration files.

---

#### 2. Concept – Kubernetes Secrets

A **Secret** in Kubernetes securely stores sensitive information such as passwords, API keys, or SSH credentials.

* Secrets prevent credentials from being visible in plain text in deployment manifests.
* They can be consumed by pods as **environment variables** or mounted as files.

For this use case, the PostgreSQL password (`PGPASSWORD`) will be stored in a Secret.

---

#### 3. Why Not Use a Config File

While most Kubernetes resources (pods, deployments, services) are created declaratively using YAML files, secrets are created **imperatively** to avoid exposing sensitive data in version-controlled config files.

Creating a secret with a YAML file would require writing the password in plaintext — defeating its purpose.

Instead, the password will be provided directly via the CLI when creating the secret.

---

#### 4. Command Breakdown

**Command:**

```bash
kubectl create secret generic pgpassword \
  --from-literal=PGPASSWORD=yourpassword123
```

**Explanation:**

* `kubectl create`: Imperative creation of a Kubernetes object.
* `secret generic`: Defines the object type and secret subtype.

  * `generic` is used for arbitrary key-value data.
  * Other secret types:

    * `docker-registry` — for private Docker image credentials.
    * `tls` — for storing TLS certificates and keys.
* `pgpassword`: The **name of the secret** (lowercase).
* `--from-literal`: Specifies key-value pairs directly in the command line.

  * Example: `PGPASSWORD=yourpassword123`

The key (`PGPASSWORD`) will later be referenced inside deployment configurations.

---

#### 5. Verifying Secret Creation

Check that the secret was created successfully:

```bash
kubectl get secrets
```

Example output:

```
NAME          TYPE      DATA   AGE
pgpassword    Opaque    1      1m
```

* `Opaque`: Default secret type for generic data.
* `DATA=1`: Indicates one key-value pair stored in this secret.

---

#### 6. Secret Scope and Usage

* The secret is **namespaced**, meaning it exists only within the namespace it was created in.
* It must be **manually created** in every environment (local, staging, production).
* Other manifests (deployments, services) can still be managed declaratively.

---

#### 7. Next Steps

The secret must now be:

1. **Injected into the multi-server deployment** as an environment variable.
2. **Referenced by the Postgres deployment** to override the container’s default password configuration.

Both integrations will ensure that:

* The database container uses the secret as its actual password.
* The multi-server application can authenticate using the same value.
