### Kubernetes — Volumes and the Need for Persistent Volume Claims (PVC) in PostgreSQL

#### **Context**

In the previous section, the PostgreSQL Deployment and its associated ClusterIP Service were completed.
Next, the focus shifts to understanding **Persistent Volume Claims (PVCs)** — specifically why PostgreSQL requires one.

---

### **1. Understanding Volumes in Containers**

* A **volume** is a mechanism to share or persist data beyond the lifecycle of a container.
* In **Docker**, volumes were used to:

  * Share the host file system with a container.
  * Sync local file changes (e.g., in a React app) into a container without rebuilding images.

---

### **2. Why PostgreSQL Needs a Volume**

**Architecture Review:**

* A **Deployment** manages a **Pod** containing a single **PostgreSQL container**.
* Inside the container, there’s an isolated file system.
* PostgreSQL writes data to this internal file system whenever it handles a `WRITE` or `SAVE` operation.

**Problem:**

* If the PostgreSQL **container** or **pod** crashes:

  * The Deployment deletes the failed pod and spins up a new one.
  * The new pod gets a fresh file system.
  * **All database data is lost**, since the original file system was tied to the destroyed container.

**Conclusion:**
Databases like PostgreSQL **cannot store data inside container file systems**. Persistent storage is required to survive restarts or crashes.

---

### **3. Solution — Using Volumes for Persistence**

* Volumes allow PostgreSQL to store data **outside** the container on the **host machine**.
* From PostgreSQL’s perspective, it still writes to its local file system.
* In reality, those writes go to a volume mounted on the host.
* If the pod or container crashes, the Deployment creates a new pod, which reattaches to the same volume.
* The new PostgreSQL instance regains access to all previously stored data.

**Result:**
Persistent, crash-resistant database storage.

---

### **4. Important Note on Scaling PostgreSQL**

Inside the Deployment:

```yaml
spec:
  replicas: 1
```

* Only **one replica** of PostgreSQL should exist.
* If replicas are increased to `2` or more without configuring a proper replication setup:

  * Multiple PostgreSQL instances would write to the **same volume**.
  * This causes **data corruption** and **conflicts**, since the instances are unaware of each other.

**Rule:**

> Never scale database replicas directly without configuring replication-aware clustering.

---

### **5. Summary**

| Concept                    | Purpose                                                                                           |
| -------------------------- | ------------------------------------------------------------------------------------------------- |
| **Volume**                 | Provides persistent storage accessible to containers.                                             |
| **Problem Without Volume** | Data loss when container or pod restarts.                                                         |
| **Volume Advantage**       | Allows PostgreSQL to retain data across pod restarts.                                             |
| **Replica Limitation**     | Only one PostgreSQL replica should use a volume at a time unless proper clustering is configured. |

---

### **Next Step**

In the upcoming section:

* Define what a **Persistent Volume Claim (PVC)** is.
* Learn how Kubernetes provisions and attaches persistent storage to the PostgreSQL pod through a PVC.
