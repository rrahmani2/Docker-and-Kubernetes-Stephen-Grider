### Setting Up Environment Variables for Multi-Server and Multi-Worker – Technical Notes

#### 1. Objective

Configure environment variables in Kubernetes for `multi-server` and `multi-worker` deployments.

* Both need **Redis** connection variables.
* The **multi-server** also requires **Postgres** connection variables.

---

#### 2. Required Environment Variables

| Component        | Environment Variables                                                                | Purpose                                     |
| ---------------- | ------------------------------------------------------------------------------------ | ------------------------------------------- |
| **multi-worker** | `REDIS_HOST`, `REDIS_PORT`                                                           | Connect to Redis through ClusterIP service. |
| **multi-server** | `REDIS_HOST`, `REDIS_PORT`, `PGHOST`, `PGPORT`, `PGUSER`, `PGDATABASE`, `PGPASSWORD` | Connect to both Redis and Postgres.         |

---

#### 3. Constant (Non-sensitive) Environment Variables

Most variables—such as `REDIS_HOST`, `REDIS_PORT`, `PGHOST`, `PGPORT`, `PGUSER`, and `PGDATABASE`—are **constant** and can be defined directly in the deployment manifest.

* These do **not change** over time and can safely be stored in YAML files.
* Example values:

  * `REDIS_PORT=6379`
  * `PGPORT=5432`
  * `PGUSER=postgres`
  * `PGDATABASE=postgres`

---

#### 4. Redis and Postgres Host Configuration

* Each service (Redis and Postgres) is exposed internally via a **ClusterIP service**.
* Pods connect to each service using its **ClusterIP name** as the host address.

  * Example:

    * Redis ClusterIP service name: `redis-cluster-ip-service`
    * Postgres ClusterIP service name: `postgres-cluster-ip-service`
  * Therefore:

    * `REDIS_HOST=redis-cluster-ip-service`
    * `PGHOST=postgres-cluster-ip-service`

**Concept:**
In Kubernetes, pods communicate internally by referring to **service names** as DNS hostnames.
There’s no need to specify IPs; Kubernetes handles DNS resolution automatically.

---

#### 5. Sensitive Environment Variable: `PGPASSWORD`

* `PGPASSWORD` is **sensitive** and should **not** be stored directly in deployment YAML.
* Instead, it will be managed using **Kubernetes Secrets**.
* The secret will securely store the password and be referenced in the deployment configuration.

---

#### 6. Implementation Flow

1. Define all **constant environment variables** directly in deployment manifests (`multi-server` and `multi-worker`).
2. Use the **ClusterIP service names** for `REDIS_HOST` and `PGHOST`.
3. Later, create a **Secret** object to handle `PGPASSWORD` securely and inject it into the environment.

---

#### 7. Next Step

Proceed to implement environment variables for `multi-server` and `multi-worker` in their respective Kubernetes deployment files.
Afterward, configure `PGPASSWORD` using a Kubernetes Secret.
