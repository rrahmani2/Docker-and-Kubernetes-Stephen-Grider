### Kubernetes â€“ Postgres Deployment and ClusterIP Service Configuration

**Objective:**
Create Kubernetes manifests for a Postgres deployment and its associated ClusterIP service.

---

#### **Postgres Deployment**

**File:** `postgres-deployment.yaml`

1. **API Version and Kind**

   ```yaml
   apiVersion: apps/v1
   kind: Deployment
   ```

2. **Metadata**

   ```yaml
   metadata:
     name: postgres-deployment
   ```

3. **Spec**

   * **replicas:** `1`

     * Only one Postgres instance is required.
     * While Postgres can run in a clustered setup for HA, this configuration keeps it simple with a single instance.
   * **selector:** Matches pods labeled with `component: postgres`
   * **template:**

     ```yaml
     template:
       metadata:
         labels:
           component: postgres
       spec:
         containers:
           - name: postgres
             image: postgres
             ports:
               - containerPort: 5432
     ```

     * Uses the official Postgres image from Docker Hub.
     * Default Postgres port `5432` is exposed.
     * No port remapping or image customization.

---

#### **Postgres ClusterIP Service**

**File:** `postgres-clusterip-service.yaml`

1. **API Version and Kind**

   ```yaml
   apiVersion: v1
   kind: Service
   ```

2. **Metadata**

   ```yaml
   metadata:
     name: postgres-clusterip-service
   ```

3. **Spec**

   ```yaml
   spec:
     type: ClusterIP
     selector:
       component: postgres
     ports:
       - port: 5432
         targetPort: 5432
   ```

   * Internal-only (ClusterIP) service for in-cluster access.
   * Routes requests to pods labeled `component: postgres`.
   * Both `port` and `targetPort` use `5432`.

---

#### **Apply Configuration**

Run from within the project directory containing the `k8s/` folder:

```bash
kubectl apply -f k8s/
```

**Expected Output:**

* Creation of:

  * `postgres-deployment`
  * `postgres-clusterip-service`
* Existing objects will show as *unchanged*.

---

#### **Verification**

Check that pods and services are running correctly:

```bash
kubectl get pods
kubectl get services
```

**Expected Results:**

* Postgres pod is running (`Running` status).
* Postgres ClusterIP service is active on port `5432`.

---

#### **Next Steps**

* Configure environment variables in worker and server deployments for database connection.
* Implement Persistent Volume Claim (PVC) for Postgres data persistence.
