### Persistent Volume Claims and Storage Classes – Technical Notes

#### 1. Default Behavior on Local Kubernetes

* When a **PersistentVolumeClaim (PVC)** is submitted, Kubernetes must find or create a **PersistentVolume (PV)** that satisfies its requirements (size, access mode, etc.).
* On a **local environment** (e.g., Minikube), Kubernetes has limited storage options — typically, just the host machine’s **local disk**.
* Therefore, by default, Minikube provisions a PV from the host’s filesystem (a **slice of your local hard drive**) to fulfill the PVC request.

---

#### 2. Viewing the Default Storage Class

Run the following commands to inspect storage provisioning behavior:

```bash
kubectl get storageclass
```

* Output shows available **StorageClasses** on the cluster.
* Typically, you’ll see one named **standard**, marked as `(default)`.

```bash
kubectl describe storageclass standard
```

* Reveals the **provisioner** used to create persistent volumes.
* On Minikube, the default provisioner is:

  ```
  provisioner: k8s.io/minikube-hostpath
  ```

  This means volumes are provisioned directly on the **host path** of your local Minikube environment — i.e., Minikube creates a subdirectory on your host filesystem for the PV.

---

#### 3. Storage Class Concept

* A **StorageClass** defines *how* Kubernetes should provision persistent volumes dynamically.
* The **provisioner** within a StorageClass determines the storage backend used.
* Each environment (local or cloud) provides different provisioners.

---

#### 4. Behavior in Cloud Environments

When Kubernetes runs on a cloud provider, the default StorageClass is configured automatically to use that provider’s native storage service.

| Cloud Provider         | Default Provisioner / Service                | Description                                            |
| ---------------------- | -------------------------------------------- | ------------------------------------------------------ |
| **Google Cloud (GKE)** | `pd.csi.storage.gke.io` (Persistent Disk)    | Block storage volumes backed by Google Persistent Disk |
| **AWS (EKS)**          | `ebs.csi.aws.com` (Elastic Block Store)      | Block storage volumes from AWS EBS                     |
| **Azure (AKS)**        | `disk.csi.azure.com` or `file.csi.azure.com` | Azure Managed Disks or Azure Files                     |

* These cloud-native provisioners allocate actual disks or network file systems from the provider.
* If a PVC does **not** specify `storageClassName`, Kubernetes uses the **default StorageClass** for the cluster.

---

#### 5. Specifying a Custom StorageClass

To explicitly choose where Kubernetes should allocate storage:

```yaml
spec:
  storageClassName: fast-ssd
```

* This instructs Kubernetes to use a specific class (e.g., faster SSD-backed storage) instead of the default.
* Each StorageClass maps to a distinct backend configuration (performance, cost, replication, etc.).

---

#### 6. Practical Summary

| Environment          | Default Storage Location  | Provisioner                                 | Behavior                          |
| -------------------- | ------------------------- | ------------------------------------------- | --------------------------------- |
| **Minikube (local)** | Host’s filesystem         | `minikube-hostpath`                         | Creates a directory on local disk |
| **Google Cloud**     | Persistent Disk           | `pd.csi.storage.gke.io`                     | Allocates managed GCP disk        |
| **AWS**              | EBS Volume                | `ebs.csi.aws.com`                           | Allocates AWS block storage       |
| **Azure**            | Managed Disk / File Share | `disk.csi.azure.com` / `file.csi.azure.com` | Allocates Azure-managed storage   |

---

#### 7. Key Takeaway

* **Local clusters** default to host storage (good for testing).
* **Cloud clusters** default to provider-managed block or file storage.
* You can **override** defaults with `storageClassName` to target specific storage backends.

---

#### 8. Next Step

Update the **Postgres Deployment YAML** to reference the PVC explicitly so that when the Pod is created, it requests storage from the advertised **PersistentVolumeClaim** (2 Gi).
