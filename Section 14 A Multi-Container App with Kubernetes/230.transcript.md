### Applying Persistent Volume Claim and Verifying Postgres Deployment – Technical Notes

#### 1. Applying the Configuration

After defining the PersistentVolumeClaim (PVC) and integrating it into the Postgres deployment, the next step is to apply the configuration to the local Kubernetes cluster.

**Commands:**

```bash
cd complex
kubectl apply -f k8s/
```

* Ensures the working directory is set to the project root (`complex`).
* Applies all configuration files inside the `k8s/` directory.
* This creates the new PVC and updates the Postgres deployment to use it.

---

#### 2. Verification Steps

**a. Check Pod Status**

```bash
kubectl get pods
```

* Lists all running pods.
* Postgres pod should appear as **Running**.
* If it was recently reconfigured, it may show as **Restarted** before stabilizing to **Running**.

**b. Check Persistent Volumes**

```bash
kubectl get pv
```

* Displays all PersistentVolumes (PVs) currently provisioned in the cluster.
* Expected output includes:

  * **NAME**: Typically starts with `pvc-...` (auto-generated).
  * **CAPACITY**: 2Gi (as defined in the PVC).
  * **ACCESS MODES**: `RWO` (ReadWriteOnce).
  * **CLAIM**: Should reference `database-persistent-volume-claim`.
  * **STATUS**: `Bound` (indicates the volume is successfully attached to a claim).

**c. Check Persistent Volume Claims**

```bash
kubectl get pvc
```

* Lists all PVCs created in the namespace.
* Confirms that the claim exists and is **Bound** to a PersistentVolume.

---

#### 3. Conceptual Summary

| Component                       | Purpose                 | Description                                                       |
| ------------------------------- | ----------------------- | ----------------------------------------------------------------- |
| **PersistentVolume (PV)**       | Actual storage resource | Represents physical or virtual storage (e.g., disk, SSD, EBS).    |
| **PersistentVolumeClaim (PVC)** | Storage request         | Defines required size (2Gi) and access mode (RWO).                |
| **Pod (Postgres)**              | Storage consumer        | Mounts the PVC as its data directory to achieve data persistence. |

Relationship summary:

* PVC = storage request (advertisement of need).
* PV = physical storage instance satisfying that request.
* Status **Bound** confirms the PVC is successfully linked to a PV.

---

#### 4. Functional Outcome

* Postgres now writes data to a persistent storage location.
* Pod deletion or restart will **not erase database data**, since it’s retained on the bound volume.
* Current setup ensures persistence, but data testing isn’t yet possible because:

  * The **Express** and **Worker** services are not configured to interact with Postgres or Redis.

---

#### 5. Next Step

* Configure **environment variables** for **Express** and **Worker** deployments.
* These variables will define connection details (host, port, credentials) required for integration with Postgres and Redis.
