### Wiring PostgreSQL Secret to Server and Database Deployments

**1. Purpose**
Link the previously created `pgpassword` secret to:

* The **server deployment**, as an environment variable for database access.
* The **PostgreSQL deployment**, to override its default password.

---

**2. Server Deployment Configuration**

* Open `server-deployment.yaml`.
* Locate the `env:` section (environment variables list).
* Add the following entry:

```yaml
- name: PG_PASSWORD
  valueFrom:
    secretKeyRef:
      name: pgpassword        # Name of the Kubernetes Secret
      key: pgpassword         # Specific key inside the secret
```

**Explanation:**

* `name`: The environment variable inside the container (`PG_PASSWORD`).

  * This is how the application references the password internally.
* `valueFrom.secretKeyRef`: Pulls the value from the Kubernetes secret.
* `name` under `secretKeyRef`: Must match the secret’s name (`pgpassword`).
* `key`: Refers to the specific key inside that secret (also `pgpassword`).

This ensures that the container receives the database password stored in the secret without exposing it in plain text.

---

**3. PostgreSQL Deployment Configuration**

* Open `postgres-deployment.yaml`.
* Add an `env:` block inside the container definition (same indentation level as `name`, `image`, and `ports`):

```yaml
env:
  - name: POSTGRES_PASSWORD
    valueFrom:
      secretKeyRef:
        name: pgpassword
        key: pgpassword
```

**Explanation:**

* This overrides PostgreSQL’s default password with the one stored in the secret.
* `POSTGRES_PASSWORD` is recognized by the Postgres Docker image to set the database password on initialization.

**Indentation Note:**
`env:` must align with other container properties (`image`, `ports`, etc.) for valid YAML structure.

---

**4. Applying the Configuration**
Run the following to apply all updated YAML files in the `k8s` directory:

```bash
kubectl apply -f k8s/
```

If you encounter an error like `Cannot convert N64 into string`, it’s likely due to a type mismatch in one of the YAML files. The issue will be addressed in the next step.

---

**Result:**

* Both the **server** and **PostgreSQL** pods now use the same password from the Kubernetes secret.
* Passwords remain secure and are not hardcoded in configuration files.
