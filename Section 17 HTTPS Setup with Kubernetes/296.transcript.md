### Cert-Manager Certificate Configuration — Technical Notes

**Objective:**
Create the Kubernetes configuration file (`certificate.yaml`) defining the specific TLS certificate Cert-Manager should obtain from Let’s Encrypt for your domain.

---

#### 1. **File Location**

Create a new file:

```bash
k8s/certificate.yaml
```

---

#### 2. **Purpose**

The **Certificate** resource specifies:

* Which domain names the certificate should cover.
* Which **Issuer** (e.g. Let’s Encrypt) to use for certificate requests.
* Where to store the generated TLS secret.

Cert-Manager uses this configuration to automatically issue and renew the certificate.

---

#### 3. **YAML Configuration Example**

```yaml
apiVersion: certmanager.k8s.io/v1alpha1
kind: Certificate
metadata:
  name: k8smulti-com-tls
spec:
  # Secret where the certificate and private key will be stored
  secretName: k8smulti-com

  # Reference to the ClusterIssuer defined earlier
  issuerRef:
    name: letsencrypt-prod
    kind: ClusterIssuer

  # Certificate details
  commonName: k8smulti.com
  dnsNames:
    - k8smulti.com
    - www.k8smulti.com

  # ACME verification method
  acme:
    config:
      - http01:
          ingressClass: nginx
        domains:
          - k8smulti.com
          - www.k8smulti.com
```

---

#### 4. **Key Fields Explained**

| Field                 | Description                                                                                                                                   |
| --------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| `apiVersion`          | Matches the Cert-Manager API group version. (May be `cert-manager.io/v1` in newer releases.)                                                  |
| `kind: Certificate`   | Tells Kubernetes this resource requests a TLS certificate.                                                                                    |
| `metadata.name`       | Logical name of the certificate object. Usually `<domain>-tls`.                                                                               |
| `spec.secretName`     | Name of the **Kubernetes Secret** where Cert-Manager will store the issued certificate and private key. This secret is created automatically. |
| `issuerRef`           | References the **ClusterIssuer** (Let’s Encrypt) to request the certificate.                                                                  |
| `commonName`          | The primary domain name displayed on the certificate (CN field).                                                                              |
| `dnsNames`            | List of domain names the certificate is valid for — both root (`example.com`) and subdomains (`www.example.com`).                             |
| `acme.config`         | ACME protocol configuration defining the HTTP-01 challenge mechanism and domains for verification.                                            |
| `http01.ingressClass` | Specifies which Ingress controller (e.g., `nginx`) will handle ACME HTTP-01 challenges.                                                       |

---

#### 5. **How the Validation Works**

* Cert-Manager creates temporary **Ingress routes** for each domain under
  `.well-known/acme-challenge/` for verification.
* Let’s Encrypt accesses these routes to confirm domain ownership.
* After successful validation, Cert-Manager automatically stores the issued certificate in the specified **Secret**.

---

#### 6. **Apply and Verify**

Apply the configuration:

```bash
kubectl apply -f k8s/certificate.yaml
```

Check certificate creation:

```bash
kubectl get certificate
kubectl describe certificate k8smulti-com-tls
```

Expected result after successful validation:

```
Status:
  Conditions:
  - Type: Ready
    Status: True
```

Verify that the secret was created:

```bash
kubectl get secret k8smulti-com
```

---

#### 7. **Next Step**

Once the certificate is ready, you can reference this secret (`k8smulti-com`) inside your **Ingress** resource to enable HTTPS termination.

---

**Summary:**
This configuration tells Cert-Manager to obtain a Let’s Encrypt TLS certificate for both `k8smulti.com` and `www.k8smulti.com` using HTTP-01 verification handled by the Nginx Ingress controller. The resulting certificate and private key are automatically stored in a Kubernetes Secret for later use in securing your application traffic.
