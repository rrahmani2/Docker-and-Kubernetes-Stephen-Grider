### Cert-Manager Issuer Configuration — Technical Notes

**Objective:**
Create an `issuer.yaml` configuration file to define how Cert-Manager connects to **Let’s Encrypt** and requests TLS certificates.

---

#### 1. **File Location**

Create the file:

```bash
k8s/issuer.yaml
```

---

#### 2. **Purpose**

The **Issuer (or ClusterIssuer)** object instructs Cert-Manager:

* Which Certificate Authority (CA) to contact (Let’s Encrypt).
* Which verification method to use (HTTP-01).
* How to identify itself (email and secret reference).

This configuration defines *how* certificates are requested, not *what* certificates are issued.

---

#### 3. **YAML Structure Breakdown**

```yaml
apiVersion: certmanager.k8s.io/v1alpha1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    # Let’s Encrypt production API endpoint
    server: https://acme-v02.api.letsencrypt.org/directory

    # Registration email (required by Let’s Encrypt)
    email: your-email@example.com

    # Secret to store the private key used in the ACME registration
    privateKeySecretRef:
      name: letsencrypt-prod

    # ACME challenge type: HTTP-01
    http01: {}
```

---

#### 4. **Key Fields Explained**

| Field                 | Description                                                                                                                                                              |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `apiVersion`          | References Cert-Manager’s CRD API group. May vary with version (e.g. `cert-manager.io/v1` in newer releases).                                                            |
| `kind: ClusterIssuer` | Defines a cluster-wide issuer (used across all namespaces).                                                                                                              |
| `server`              | Let’s Encrypt API endpoint. <br> - Production: `https://acme-v02.api.letsencrypt.org/directory` <br> - Staging: `https://acme-staging-v02.api.letsencrypt.org/directory` |
| `email`               | Contact email required by Let’s Encrypt.                                                                                                                                 |
| `privateKeySecretRef` | Stores a registration key used for ACME validation (not the TLS cert). Automatically created.                                                                            |
| `http01`              | Defines HTTP-based validation. Cert-Manager uses an Ingress path to prove domain ownership.                                                                              |

---

#### 5. **HTTP-01 Challenge Summary**

* Let’s Encrypt issues a challenge to verify domain control.
* Cert-Manager automatically configures an **Ingress** to serve a response at a special URL under:

  ```
  http://<your-domain>/.well-known/acme-challenge/<token>
  ```
* Once verified, the certificate is issued.

---

#### 6. **Verification Steps**

After saving the file, apply it:

```bash
kubectl apply -f issuer.yaml
```

Check if the `ClusterIssuer` was created successfully:

```bash
kubectl get clusterissuer
kubectl describe clusterissuer letsencrypt-prod
```

Status should show as:

```
Status:
  Conditions:
  - Type: Ready
    Status: True
```

---

#### 7. **Next Step**

Create the **Certificate** configuration file (`certificate.yaml`) to specify:

* Which domain names need a certificate.
* Which `ClusterIssuer` to use.
* Where the TLS secret should be stored.

---

**Summary:**
The `ClusterIssuer` configuration tells Cert-Manager to communicate with the **Let’s Encrypt production API** using the **HTTP-01 challenge** method. It defines the verification endpoint, contact email, and a secret for the registration key. Once active, this issuer will be referenced by certificate objects to obtain and renew TLS certificates automatically.
