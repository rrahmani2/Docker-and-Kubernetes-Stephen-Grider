### Step 9: Creating and Securing the Google Cloud Service Account for Travis CI

#### Objective

Enable Travis CI to authenticate with Google Cloud by securely generating and encrypting a **service account key** (`service-account.json`).

---

### 1. Create the Service Account in Google Cloud

1. **Log in** to the Google Cloud Console.
2. Open the **Navigation Menu (☰)** → **IAM & Admin** → **Service Accounts**.
3. Click **Create Service Account**.
4. Enter a name — for example:

   ```
   travis-deployer
   ```

   *(The name is arbitrary; it just describes the purpose of the account.)*
5. Under **Grant this service account access to project**, assign the role:

   ```
   Kubernetes Engine Admin
   ```

   This role grants full control over your Kubernetes cluster (create, delete, update resources).
6. Check the box to **Furnish a new private key**, and select **JSON** as the key type.
7. Click **Create** — this automatically downloads a JSON key file (your service account credentials).

---

### 2. Understand What the File Is

The downloaded file — for example:

```
travis-deployer-<unique-id>.json
```

contains credentials that allow full programmatic access to your Google Cloud project.

You will rename it locally to:

```
service-account.json
```

> ⚠️ **Security Warning**
> This JSON key contains sensitive credentials.
> Never:
>
> * Commit it to GitHub
> * Share or email it
> * Upload it to any cloud storage in plaintext

This file is effectively your **password** for Google Cloud API access.

---

### 3. Why We Encrypt It

Instead of storing plaintext credentials in your repository, you’ll **encrypt the file using the Travis CLI**.
This allows Travis CI to:

* Store the encrypted file securely.
* Decrypt it *only* during the build process.

This approach is similar to how encrypted environment variables are handled, except now you’re encrypting a **file**, not just a string.

---

### 4. What Happens Next

In the next step, you’ll:

* Install the **Travis CLI** on your local machine.
* Use it to **encrypt** and **upload** the `service-account.json` file to your Travis project.
* Update `.travis.yml` to **decrypt** it during the build and authenticate Google Cloud via:

  ```bash
  gcloud auth activate-service-account --key-file service-account.json
  ```

This will allow Travis CI to securely access your GKE cluster for deployment.

---

### Summary

| Step | Action                                | Purpose                              |
| ---- | ------------------------------------- | ------------------------------------ |
| 1    | Create a Service Account              | Gives Travis CI programmatic access  |
| 2    | Assign `Kubernetes Engine Admin` role | Full control of cluster resources    |
| 3    | Generate JSON key                     | Local credentials for authentication |
| 4    | Encrypt with Travis CLI               | Protect credentials from exposure    |
| 5    | Reference in `.travis.yml`            | Enable automated GCP authentication  |

---

Next section → **Install the Travis CLI and Encrypt the Service Account JSON file.**
