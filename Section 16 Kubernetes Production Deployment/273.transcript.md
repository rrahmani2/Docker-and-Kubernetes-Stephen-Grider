### Automatic Image Tagging and Deployment Setup

#### 1. Add Environment Variables in `.travis.yml`

To automate image version tagging, the current Git commit SHA must be captured and exported as an environment variable.
Edit the `.travis.yml` file and add the following block **after the `services` section**:

```yaml
env:
  global:
    - SHA=$(git rev-parse HEAD)
    - CLOUDSDK_CORE_DISABLE_PROMPTS=1
```

**Explanation:**

* `SHA=$(git rev-parse HEAD)`

  * Captures the current Git commit SHA and stores it as an environment variable `SHA`.
  * This value will later be referenced in the `deploy.sh` script to uniquely tag Docker images.

* `CLOUDSDK_CORE_DISABLE_PROMPTS=1`

  * Disables all interactive prompts in Google Cloud SDK commands (e.g., `gcloud auth activate-service-account`).
  * Prevents Travis CI from hanging due to prompts that require manual confirmation.

Ensure the variable name `CLOUDSDK_CORE_DISABLE_PROMPTS` is **spelled and capitalized correctly**.

---

#### 2. Modify `deploy.sh` to Apply Dual Image Tagging

Open `deploy.sh` and update the image build commands to apply **two tags**:

1. `latest`
2. `$SHA` (from the environment variable set in `.travis.yml`)

**Example for `client` image:**

```bash
docker build -t <DOCKER_ID>/multi-client:latest \
             -t <DOCKER_ID>/multi-client:$SHA \
             -f ./client/Dockerfile ./client
```

Repeat this structure for `server` and `worker`:

```bash
docker build -t <DOCKER_ID>/multi-server:latest \
             -t <DOCKER_ID>/multi-server:$SHA \
             -f ./server/Dockerfile ./server

docker build -t <DOCKER_ID>/multi-worker:latest \
             -t <DOCKER_ID>/multi-worker:$SHA \
             -f ./worker/Dockerfile ./worker
```

---

#### 3. Push All Tags to Docker Hub

Since Docker requires explicit pushes for each tag, push both `latest` and `$SHA` for all images:

```bash
docker push <DOCKER_ID>/multi-client:latest
docker push <DOCKER_ID>/multi-server:latest
docker push <DOCKER_ID>/multi-worker:latest

docker push <DOCKER_ID>/multi-client:$SHA
docker push <DOCKER_ID>/multi-server:$SHA
docker push <DOCKER_ID>/multi-worker:$SHA
```

---

#### 4. Update Kubernetes Deployments with SHA-Tagged Images

After pushing the images, update Kubernetes deployments to use the newly built SHA-specific tags:

```bash
kubectl set image deployments/server-deployment server=<DOCKER_ID>/multi-server:$SHA
kubectl set image deployments/client-deployment client=<DOCKER_ID>/multi-client:$SHA
kubectl set image deployments/worker-deployment worker=<DOCKER_ID>/multi-worker:$SHA
```

Each deployment explicitly references the SHA-tagged image version to trigger a new rollout.

---

#### 5. Final Verification

* Double-check that **all image references** in both the build and push steps use:

  * Correct image names (`multi-client`, `multi-server`, `multi-worker`)
  * Correct variable `$SHA` (not `$GIT_SHA`, `$sha`, or hardcoded values)

* Ensure consistency across all references:

  ```
  client → client
  server → server
  worker → worker
  ```

---

#### Summary

* `.travis.yml` defines `SHA` and disables GCloud prompts.
* `deploy.sh` builds images with both `latest` and `$SHA` tags.
* Each image is pushed twice — once for `latest`, once for `$SHA`.
* Kubernetes deployments are updated to use `$SHA`-specific image tags to ensure new rollouts on every commit.

Next step: finalize setup within the Google Cloud Kubernetes cluster before deployment testing.
