**Synopsis:**
This section explains how to configure and build the **production Dockerfile for the React client**. The main goal is to make Nginx serve the built React assets on **port 3000** instead of port 80 by adding a **custom Nginx configuration file (`default.conf`)** and integrating it into a **multi-stage Docker build**.

---

### Transcript Summary

#### Objective

Configure Nginx to serve the React app on **port 3000** and build a **multi-stage Dockerfile** that incorporates both the React build process and the custom Nginx setup.

---

### 1. Creating a Custom Nginx Configuration

Inside the **client** project directory:

1. Create a new folder named **`nginx`**.
2. Inside it, create a file named **`default.conf`** (the lecturer mistakenly said “default.com” but meant `.conf`).

This configuration file defines how Nginx serves the React production files.

**Example content (`client/nginx/default.conf`):**

```nginx
server {
    listen 3000;

    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri /index.html;
    }
}
```

**Purpose:**

* `listen 3000;` ensures Nginx runs on **port 3000**.
* `root /usr/share/nginx/html;` tells Nginx where to find the built React files.
* `index` defines the default file to serve.
* The optional `try_files` directive ensures React routes work properly by serving `index.html` for any unmatched routes.

---

### 2. Writing the Production Dockerfile

Now in the **client** directory, create the **`Dockerfile`** for the production React build.

This Dockerfile uses a **multi-stage build** — one for compiling the React code and another for serving it through Nginx.

**Example content (`client/Dockerfile`):**

```dockerfile
# Stage 1: Build React app
FROM node:alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# Stage 2: Serve using Nginx
FROM nginx
EXPOSE 3000
COPY nginx/default.conf /etc/nginx/conf.d/default.conf
COPY --from=builder /app/build /usr/share/nginx/html
```

**Explanation:**

* The **builder stage** compiles the React source using Node.
* The **final stage**:

  * Uses the official Nginx image.
  * **Exposes port 3000** instead of port 80.
  * Copies in the **custom Nginx configuration** to override the default.
  * Copies built static files from `/app/build` into Nginx’s web root.

---

### 3. Key Takeaways

* The **only difference** from the previous single-container Dockerfile is:

  * **Custom Nginx configuration** listening on port 3000.
  * **Additional copy instruction** to include this config file in the final image.
* This setup allows the React app to be served internally on port 3000 while the main Nginx router handles requests from port 80.

---

### Summary

* Created a custom Nginx config file to make Nginx **listen on port 3000**.
* Wrote a **multi-stage Dockerfile** that builds the React app and serves it via Nginx.
* Integrated both the configuration and build steps to produce a **production-ready Docker image** for the client service.

Next: proceed to building and testing the client container.
