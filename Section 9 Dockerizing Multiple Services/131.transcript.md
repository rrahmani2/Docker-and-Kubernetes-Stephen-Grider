### üß© **Synopsis: Building a Custom Nginx Image and Adding It as a Docker Compose Service**

This section covers how to create a **custom Nginx Docker image** that uses the previously built `default.conf` file, and how to integrate this image as a new **Nginx service** in the Docker Compose configuration.
Nginx will act as the **reverse proxy** for the entire application stack, routing incoming traffic to the appropriate backend service.

---

### ‚öôÔ∏è **Step-by-Step Explanation**

1. **Understanding the Goal**

   * You‚Äôll create a **custom Nginx image** that uses your own routing configuration (`default.conf`).
   * The image will be used in Docker Compose as a separate service named `nginx`.
   * Nginx will always be running to route browser requests to the correct containers (`client` or `api`).

2. **Base Image and Configuration Source**

   * The **official Nginx image** from Docker Hub will serve as the base image.
   * Your custom configuration (`default.conf`) will replace the default Nginx configuration.
   * Nginx uses configuration files located at:

     ```
     /etc/nginx/conf.d/
     ```

     This directory already contains a default configuration file named `default.conf`.

3. **Creating the Custom Dockerfile**

   * Inside the `nginx` folder, create a file named `Dockerfile.dev`.
   * Add the following content:

     ```dockerfile
     FROM nginx
     COPY ./default.conf /etc/nginx/conf.d/default.conf
     ```
   * **Explanation:**

     * `FROM nginx` ‚Üí starts from the official Nginx base image.
     * `COPY` ‚Üí copies your `default.conf` into the container‚Äôs configuration directory, overwriting the existing one.

4. **Why Overwrite the Existing File**

   * Nginx automatically loads any file named `default.conf` in `/etc/nginx/conf.d/`.
   * Overwriting it ensures that your custom routing rules are applied when the container starts.
   * No need to modify the default startup command ‚Äî Nginx‚Äôs default command runs automatically.

5. **Adding Nginx to Docker Compose**

   * Open your `docker-compose.yml` file.
   * Add a new service named **`nginx`** with the following configuration:

     ```yaml
     nginx:
       build:
         context: ./nginx
         dockerfile: Dockerfile.dev
       restart: always
       ports:
         - "3050:80"
     ```
   * **Explanation:**

     * `build` ‚Üí points to the custom Dockerfile and context directory.
     * `restart: always` ‚Üí ensures Nginx restarts automatically if it fails.
     * `ports` ‚Üí maps port `3050` on your host to port `80` inside the Nginx container.

       * This means your entire application will be accessible at **[http://localhost:3050](http://localhost:3050)**.

6. **Restart Policy Rationale**

   * The Nginx container is the **entry point** for all external traffic.
   * If it fails, no requests will reach the backend services.
   * Therefore, it uses `restart: always` to ensure high availability.
   * Other services (like `worker`) can safely remain stopped if they crash, since they handle background processing only.

7. **Next Step**

   * With Nginx integrated into Docker Compose, the system is now ready to test.
   * The next section will focus on **running `docker-compose up`** and verifying that Nginx correctly routes requests between the frontend and backend.

---

### üß† **Summary**

* Created a **custom Nginx image** using `Dockerfile.dev` with a copied `default.conf`.
* Integrated this image into the **Docker Compose** configuration as a new `nginx` service.
* Configured Nginx to **restart automatically** and **expose port 3050 ‚Üí 80** for access via localhost.
* The Nginx service now acts as a **central reverse proxy**, forwarding requests to `client` or `api` as per the routing rules.
