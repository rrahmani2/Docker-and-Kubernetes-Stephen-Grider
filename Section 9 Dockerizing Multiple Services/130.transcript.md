### üß© **Synopsis: Creating and Configuring Nginx for Request Routing**

This section explains how to configure **Nginx** as a reverse proxy that routes browser requests to either the **client (React)** or **API (Express)** services inside a Docker Compose setup. The configuration is stored in a custom file named `default.conf` and will later be built into a custom Nginx Docker image.

---

### ‚öôÔ∏è **Step-by-Step Explanation**

1. **Purpose of Nginx Configuration**

   * Nginx will inspect incoming requests and **route them to the correct backend service**:

     * `/` ‚Üí Client (React app)
     * `/api/...` ‚Üí API (Express server)
   * This routing logic will be implemented in a configuration file called **`default.conf`**.

2. **File Creation**

   * Inside the root project directory, create a new folder named `nginx`.
   * Inside it, create a file called **`default.conf`** (not `.com` ‚Äî that was a verbal slip).
   * This file will define **routing rules** and **upstream server connections**.

3. **Defining Upstream Servers**

   * Upstream servers are backend services Nginx can forward requests to.
   * Define two upstreams:

     ```nginx
     upstream client {
       server client:3000;
     }

     upstream api {
       server api:5000;
     }
     ```
   * Explanation:

     * `client:3000` ‚Üí React app‚Äôs default development port.
     * `api:5000` ‚Üí Express server‚Äôs listening port.
   * The names `client` and `api` correspond to **service names** in the `docker-compose.yml` file.
     Docker Compose automatically provides internal DNS resolution, so `client` and `api` are valid hostnames inside the network.

4. **Why Rename ‚ÄúServer‚Äù to ‚ÄúAPI‚Äù**

   * Using `server` as a service name inside Nginx configuration causes confusion because ‚Äúserver‚Äù is a **reserved keyword** in Nginx.
   * To avoid syntax conflicts, rename the backend service from `server` to **`api`** in `docker-compose.yml`.

5. **Main Nginx Server Block**

   * Define the main HTTP listener and routing logic:

     ```nginx
     server {
       listen 80;

       location / {
         proxy_pass http://client;
       }

       location /api {
         rewrite /api/(.*) /$1 break;
         proxy_pass http://api;
       }
     }
     ```
   * **Explanation:**

     * `listen 80;` ‚Üí Nginx listens on port 80 *inside the container*.
     * `location /` ‚Üí Routes all root requests to the React app.
     * `location /api` ‚Üí Routes `/api/...` requests to the Express API.
     * `rewrite /api/(.*) /$1 break;` ‚Üí Removes `/api` prefix before passing the request to the API backend.

6. **Semicolon Importance**

   * Every directive in Nginx must end with a **semicolon** (`;`).
     Missing semicolons cause parsing errors during container startup.

7. **Integrating the Configuration with Docker**

   * The `default.conf` file won‚Äôt affect Nginx until it‚Äôs **copied into a Docker image**.
   * In the next step, a **custom Nginx Dockerfile** will be created to:

     * Start from the official Nginx base image.
     * Copy this custom configuration into the image.
     * Define it as the active configuration for the container.

---

### üß† **Summary**

* A new `nginx/default.conf` file defines how Nginx routes incoming requests.
* **Upstreams** point to internal Docker services:

  * `client:3000` ‚Üí React frontend.
  * `api:5000` ‚Üí Express backend.
* The `/api` prefix is removed before proxying requests to the backend.
* The term ‚Äúserver‚Äù is replaced with ‚Äúapi‚Äù to avoid Nginx keyword conflicts.
* The next step is building a **custom Nginx Docker image** using this configuration.
