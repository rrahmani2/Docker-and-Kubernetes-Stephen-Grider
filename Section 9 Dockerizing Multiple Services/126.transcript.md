### üß© **Synopsis: Setting Environment Variables in Docker Compose for the Server**

This section explains how to configure **environment variables** in the Docker Compose file to properly set up connections for the **server service** (particularly for Redis and Postgres). The instructor shows the difference between defining environment variables **at build time** (inside a Dockerfile) and **at runtime** (via Docker Compose). These variables customize the server container‚Äôs behavior when it starts, allowing it to connect to other services defined in the same Compose network.

---

### üß± **Key Steps and Concepts**

1. **Purpose:**

   * The server needs environment variables like `REDIS_HOST`, `REDIS_PORT`, `PGUSER`, `PGHOST`, `PGDATABASE`, `PGPASSWORD`, and `PGPORT` to connect to Redis and Postgres.

2. **Where to Configure:**

   * Inside the **`docker-compose.yml`** file, under the **`server:`** service block.

3. **Runtime Environment Variables:**

   * Environment variables in Docker Compose are applied **when a container runs**, not when an image is built.
   * This means they are **not baked into the image** but are available at container startup.

4. **Syntax for Defining Variables:**

   ```yaml
   environment:
     - VARIABLE_NAME=value
   ```

   * Example:

     ```yaml
     environment:
       - REDIS_HOST=redis
       - REDIS_PORT=6379
     ```

   * The value after `=` can either:

     * Be explicitly defined (as above), or
     * Pulled from the host machine if no value is provided (e.g., `- API_KEY`).

   In this setup, values are explicitly set inside the Compose file for consistency.

5. **Redis Configuration:**

   * `REDIS_HOST=redis` ‚Üí Refers to the service name (`redis`) defined in Compose.
   * `REDIS_PORT=6379` ‚Üí Default Redis port (confirmed from Docker Hub).

6. **Postgres Configuration:**

   * Default values derived from **Postgres Docker Hub docs**:

     ```yaml
     - PGUSER=postgres
     - PGHOST=postgres
     - PGDATABASE=postgres
     - PGPASSWORD=postgres_password
     - PGPORT=5432
     ```

7. **Editor Shortcut Tip:**

   * In editors like VS Code or Atom, you can use `Cmd + D` (or `Ctrl + D` on Windows) for **multi-selection** to quickly edit multiple instances (like multiple `env.` variables in `keys.js`).

8. **Verification Step:**

   * After adding all environment variables:

     ```bash
     docker compose up
     ```

     * This rebuilds the server image and starts all services.
     * Seeing the message ‚Äú**listening**‚Äù in the logs means the setup worked.

---

### ‚öôÔ∏è **Example Docker Compose Snippet**

```yaml
services:
  server:
    build:
      context: ./server
      dockerfile: Dockerfile.dev
    volumes:
      - /app/node_modules
      - ./server:/app
    environment:
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - PGUSER=postgres
      - PGHOST=postgres
      - PGDATABASE=postgres
      - PGPASSWORD=postgres_password
      - PGPORT=5432
    depends_on:
      - redis
      - postgres
```

---

### üß† **Key Takeaway**

Environment variables defined in Docker Compose control how containers interact at **runtime**, allowing each service (like the server) to dynamically locate and authenticate with others (like Redis and Postgres) within the same Docker network.
