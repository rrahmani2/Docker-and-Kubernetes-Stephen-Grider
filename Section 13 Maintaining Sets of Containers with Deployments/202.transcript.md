### Updating Deployment with a New Docker Image Version — Tutor Notes

#### Objective

Update the Kubernetes deployment to use the latest Docker image version after tagging and pushing the new image to Docker Hub.

---

### Steps Overview

1. **Tag the Docker image** with a unique version number.
2. **Push the tagged image** to Docker Hub.
3. **Run a `kubectl set image` command** to update the deployment’s image version.

---

### Step 1: Tag the Image

* Move into the **client project directory**:

  ```bash
  cd complex/client
  ```
* Build a new image with a version tag:

  ```bash
  docker build -t <docker-id>/multi-client:v5 .
  ```

  Replace `v5` with any unique version number (e.g., `v1`, `v2`, etc.).
* Push the image to Docker Hub:

  ```bash
  docker push <docker-id>/multi-client:v5
  ```

---

### Step 2: Update the Deployment

Use `kubectl set image` to update the image version in the existing deployment.

**Command Structure:**

```bash
kubectl set image deployment/<deployment-name> <container-name>=<docker-id>/multi-client:<version>
```

**Example:**

```bash
kubectl set image deployment/client-deployment client=<docker-id>/multi-client:v5
```

**Explanation:**

* `kubectl set image` → updates a property (the container image) of a Kubernetes object.
* `deployment/client-deployment` → specifies the deployment to modify.
* `client=` → specifies the container inside the deployment.
* `<docker-id>/multi-client:v5` → sets the container’s new image version.

---

### Step 3: Verify Pod Recreation

After running the command:

```bash
kubectl get pods
```

* You should see a **new pod** with an **age of a few seconds**, indicating that Kubernetes recreated it using the updated image.

---

### Step 4: Validate the Update

1. Retrieve Minikube’s IP:

   ```bash
   minikube ip
   ```
2. Access the app in the browser:

   ```
   http://<minikube-ip>:31515
   ```

   (Port `31515` is defined in the NodePort service for the client.)
3. The updated app (e.g., “Fib Calculator Version 2”) should appear.

**If not visible immediately:**

* Wait a few seconds and refresh.
* In Chrome DevTools → **Network tab**, enable **“Disable cache”** and reload.
* If still unchanged, rerun the `kubectl set image` command.

---

### Notes

* This manual update process is repetitive: rebuild → tag → push → set image.
* In production environments (e.g., AWS or GCP), this process is **automated** using deployment scripts:

  * The scripts handle image tagging, pushing, and running the `kubectl set image` command automatically.

---

### Summary

* **Problem:** Kubernetes doesn’t automatically redeploy pods when images are updated on Docker Hub.
* **Solution:**

  1. Tag image with a unique version.
  2. Push to Docker Hub.
  3. Use `kubectl set image` to force the deployment to update.
* **Outcome:** Deployment recreates pods using the latest image version.
