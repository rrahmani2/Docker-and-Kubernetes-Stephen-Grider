# **Tutor Notes — Preparing for Image Updates in Kubernetes Deployments**

## Objective

Simulate how to update a Kubernetes deployment when a **new version of a Docker image** becomes available.

---

## Step 1: Background

So far, updates were made by:

* Changing **replica count**
* Changing **container port**
* Changing **image name**

Now, the focus is on:

> Updating a deployment to use the **latest image version** after pushing an updated image to Docker Hub.

---

## Step 2: Scenario Setup

We’ll simulate a new application version by:

1. Switching the deployment back to use the **multi-client** image.
2. Making and pushing a new image version to **Docker Hub**.
3. Forcing Kubernetes to **pull the updated image** and **recreate pods**.

This mirrors a real production workflow where updated container images must propagate into the cluster.

---

## Step 3: Modify Deployment Configuration

Open `client-deployment.yaml` and make the following updates:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: client-deployment
spec:
  replicas: 1               # Simplify for testing
  selector:
    matchLabels:
      component: web
  template:
    metadata:
      labels:
        component: web
    spec:
      containers:
        - name: client
          image: <docker-id>/multi-client   # Switch back from multi-worker
          ports:
            - containerPort: 3000           # Restore correct exposed port
```

Changes made:

* **Replicas** reduced from 5 → 1 for simplicity.
* **Image** switched to `multi-client`.
* **Port** changed from `9999` → `3000` (the port Nginx in the image listens on).

---

## Step 4: Apply Updated Deployment

Run:

```bash
kubectl apply -f client-deployment.yaml
```

Output:

```
deployment.apps/client-deployment configured
```

Indicates the deployment was updated (not newly created).

---

## Step 5: Verify in Browser

1. Get the Minikube IP:

   ```bash
   minikube ip
   ```

   Example output:

   ```
   192.168.49.2
   ```

2. Access the app in the browser:

   ```
   http://192.168.49.2:31515
   ```

   > `31515` corresponds to the **NodePort** defined in the service YAML.

3. You should see the **multi-client** React application load successfully — confirming the deployment is running the correct image and port.

---

## Step 6: Next Steps

In the next step:

* Update the **multi-client source code**.
* **Rebuild** and **push** the new Docker image to Docker Hub.
* Then configure the deployment to **pull and run** the updated image version.

---

### Key Takeaways

| Concept                    | Explanation                                                  |
| -------------------------- | ------------------------------------------------------------ |
| **Image version update**   | Simulates real-world application upgrades in Kubernetes.     |
| **Replicas = 1**           | Simplifies tracking pod recreation during testing.           |
| **Port alignment**         | Must match the exposed port inside the image (Nginx → 3000). |
| **Minikube IP + NodePort** | Used to access the service externally from a browser.        |
